# 火柴人大逃亡 - 專案待辦清單

## 核心功能

- [x] 實作載入畫面(5秒進度條動畫)
- [x] 建立遊戲主畫面佈局
- [x] 左上區域:個人檔案、好友
- [x] 左側中間:轉盤
- [x] 左側下方:階級、活動、商店
- [x] 中間下方:聊天室、戰隊、背包、武器庫
- [x] 右上區域:郵件、設定、新消息、錢幣顯示
- [x] 右側遊戲模式按鈕:多人模式、戰場模式、打怪模式、劇情模式
- [x] 為每個按鈕添加對應的圖標/標誌
- [x] 實作頁面互動動畫效果
- [x] 設定深色主題和遊戲風格配色
- [x] 測試所有互動功能

## 設計風格

- 主題:深色科技風格
- 配色:深灰、藍色、橙色強調色
- 字體:現代科技感字體
- 動畫:流暢的過渡效果和懸停互動

## 新增功能 - 用戶系統與簽到

- [x] 升級專案到 web-db-user 功能
- [x] 建立用戶資料庫模型(帳號、密碼、最後簽到時間)
- [x] 實作登入頁面(使用 Manus OAuth)
- [x] 實作註冊頁面(使用 Manus OAuth)
- [x] 實作用戶認證系統
- [x] 建立每日簽到獎勵彈窗
- [x] 實作簽到狀態檢查(未領取持續顯示)
- [x] 建立個人資料頁面
- [x] 添加頁面轉換過場動畫
- [x] 測試登入註冊流程
- [x] 測試每日簽到功能
- [x] 測試頁面轉換動畫

## 新需求 - 功能頁面與後台管理

### 數據調整
- [x] 修改玩家初始金幣為 1000
- [x] 將 GP(寶石) 改名為 C幣
- [x] 修改載入畫面邏輯(只在首次進入或重新整理時顯示)

### 資料庫擴展
- [x] 建立商店補給箱資料表
- [x] 建立轉盤項目資料表
- [x] 建立活動資料表
- [x] 建立郵件資料表

### 功能頁面
- [x] 建立商店頁面(補給箱列表展示)
- [x] 建立轉盤頁面(轉盤項目展示)
- [x] 建立活動頁面(活動列表和詳情)
- [x] 建立設定頁面
- [x] 建立郵件頁面
- [x] 添加所有頁面路由和導航面添加過場動畫

### 後台管理系統
- [ ] 建立管理員權限檢查
- [ ] 建立後台首頁(管理導航)
- [ ] 建立商店補給箱管理(新增/刪除/排序)
- [ ] 建立轉盤項目管理(新增/刪除/排序)
- [ ] 建立活動管理(新增/刪除/排序)
- [ ] 建立郵件管理(新增/刪除)

### 測試
- [ ] 測試所有頁面切換和過場動畫
- [ ] 測試後台管理功能
- [ ] 測試載入畫面邏輯

## 後台管理系統開發

- [x] 建立後台管理首頁(/admin)
- [x] 實作管理員權限檢查
- [x] 建立商店補給箱管理頁面(新增/編輯/刪除/排序)
- [x] 建立轉盤獎品管理頁面(新增/編輯/刪除/排序)
- [x] 建立活動管理頁面(新增/編輯/刪除/排序)
- [x] 添加後台管理路由
- [x] 測試後台管理功能

## Bug 修復

- [x] 修復幸運轉盤按鈕無法導航的問題
- [x] 測試所有主畫面按鈕的導航功能

## 稀有度系統調整

- [x] 調整稀有度等級:神話(紅色) > 傳奇(黃色) > 史詩(紫色) > 稀有(藍色) > 普通(灰色)
- [x] 修正轉盤頁面的稀有度配色
- [x] 修正商店頁面的稀有度配色
- [ ] 更新後台管理的稀有度選項

## 後台管理完善

- [x] 建立轉盤管理頁面(/admin/wheel)
- [x] 建立活動管理頁面(/admin/activity)
- [ ] 實作 tRPC API 連接資料庫
- [ ] 讓前台商店頁面顯示後台新增的商品
- [ ] 讓前台轉盤頁面顯示後台新增的獎品
- [ ] 讓前台活動頁面顯示後台新增的活動

## 資料庫串接

- [x] 建立商店 CRUD API (shop.create, shop.list, shop.update, shop.delete, shop.reorder)
- [x] 建立轉盤 CRUD API (wheel.create, wheel.list, wheel.update, wheel.delete, wheel.reorder)
- [x] 建立活動 CRUD API (activity.create, activity.list, activity.update, activity.delete, activity.reorder)
- [ ] 更新 AdminShopPage 連接 API
- [ ] 更新 AdminWheelPage 連接 API
- [ ] 更新 AdminActivityPage 連接 API
- [ ] 更新 ShopPage 從資料庫讀取商品
- [ ] 更新 WheelPage 從資料庫讀取獎品
- [ ] 更新 ActivityPage 從資料庫讀取活動
- [ ] 測試後台新增商品在前台顯示
- [ ] 測試後台新增獎品在前台顯示
- [ ] 測試後台新增活動在前台顯示

## 後台管理修正

- [x] 修正 AdminShopPage 連接 tRPC API (新增/編輯/刪除真正儲存到資料庫)
- [x] 修正 AdminWheelPage 連接 tRPC API
- [x] 修正 AdminActivityPage 連接 tRPC API
- [x] 簡化轉盤管理欄位(移除商品類型,只保留獎品名稱和稀有度)
- [x] 更新 ShopPage 從資料庫讀取商品
- [x] 更新 WheelPage 從資料庫讀取獎品
- [ ] 更新 ActivityPage 從資料庫讀取活動
- [ ] 測試後台新增商品功能
- [ ] 測試前台顯示後台新增的內容

## 新消息系統

- [x] 擴展資料庫添加 notifications 資料表
- [x] 建立新消息 CRUD API (notifications.create, list, update, delete)
- [x] 建立新消息前台頁面 (/notifications)
- [x] 實作分類標籤篩選(全部/遊戲更新/活動更新/轉盤更新)
- [x] 建立新消息後台管理頁面 (/admin/notifications)
- [x] 測試新消息系統功能

## 背包系統開發

- [ ] 擴展資料庫添加槍械/副武器/道具資料表
- [ ] 建立槍械/副武器/道具 CRUD API
- [ ] 建立背包前台頁面(/backpack)
  - [ ] 背包總覽頁面
  - [ ] 槍械分類頁面(步槍/衝鋒槍/狙擊槍/輕機槍/霰彈槍/射手步槍)
  - [ ] 副武器分類頁面(手槍/近戰武器)
  - [ ] 戰術道具頁面
  - [ ] 連殺技能頁面
  - [ ] 終極技能頁面
- [ ] 建立背包後台管理頁面(/admin/backpack)
- [ ] 測試背包系統功能

## 背包前台頁面

- [x] 建立背包前台頁面(/backpack)
  - [x] 左側分類導航(槍械/副武器/戰術道具/連殺技能/終極技能)
  - [x] 槍械分類(步槍/衝鋒槍/狙擊槍/輕機槍/霰彈槍/射手步槍)
  - [x] 副武器分類(手槍/近戰武器)
  - [x] 右側卡片顯示(槍械/副武器使用武器卡片模板,道具使用道具卡片模板)
  - [x] 裝備/卸下功能
  - [x] 頁面轉換動畫

## 新消息頁面改進

- [x] 修改新消息頁面為展開式設計
  - [x] 只顯示標題和發佈日期
  - [x] 點擊可展開查看完整內容
  - [x] 修復內容換行問題
- [x] 添加回到頂部按鈕

## Bug 修復 - 背包按鈕導航

- [x] 修復首頁背包按鈕無法導航到 /backpack 的問題
- [x] 測試背包按鈕點擊功能

## 背包頁面簡化

- [x] 移除背包頁面的稀有度等級顯示
- [x] 簡化武器卡片，只顯示武器名稱
- [x] 移除裝備/卸下按鈕功能（暂時不需要）

## 背包後台管理系統

- [x] 建立背包資料庫模形（支援分類：槍械/副武器/戰術道具/連殺技能/終極技能）
- [ ] 建立背包 CRUD API (backpack.create, backpack.list, backpack.delete)
- [x] 建立後台管理頁面 (/admin/backpack)
  - [x] 分類選擇下拉菜單
  - [x] 物品名稱輸入框
  - [x] 新增按鈕
  - [x] 物品列表顯示
  - [x] 删除按鈕
- [ ] 連接前台背包頁面從資料庫讀取物品
- [ ] 測試後台新增物品在前台顯示

## 背包 API 同步修複

- [x] 建立背包 tRPC API (backpack.create, backpack.list, backpack.delete)
- [x] 連接後台管理頁面到 API，新增/刪除物品時保存到資料庫
- [x] 連接前台背包頁面到 API，從資料庫讀取物品
- [ ] 測試後台新增物品在前台即時顯示
- [ ] 測試後台刪除物品在前台即時刪除

## Bug 修複 - 背包新增武器

- [x] 診斷背包無法新增武器的問題
- [x] 修複背包新增武器功能
- [x] 測試新增各類別物品功能

## 新消息後台管理頁面改進

- [x] 添加內容滾動功能（內容超出螢幕時可滾動）
- [x] 添加回到頂部按鈕
- [x] 測試新消息後台管理頁面的滾動和回到頂部功能

## 新消息後台管理頁面進阶改進

- [x] 修複新增/編輯對話框的滾動問題（內容過多時無法滾動）
- [x] 簡化新消息列表，只顯示標題和日期
- [x] 添加詳情検視模式，點擊標題可展開查看完整內容和編輯
- [x] 添加置頂重要消息功能
  - [x] 在資料庫添加 isPinned 字段
  - [x] 在後台添加置頂/取消置頂按鈕
  - [x] 置頂消息顯示在列表頂部
  - [x] 前台新消息頁面也顯示置頂消息
- [x] 測試所有新功能

## Bug 修復 - 槍械後台新增

- [x] 診斷槍械後台新增無法工作的原因（returning() 不支援 + protectedProcedure 認證問題）
- [x] 查看瀏覽器控制台和伺服器日志
- [x] 修復槍械新增 API（移除 returning() 並改為 publicProcedure）
- [x] 測試槍械新增功能（成功新增 AK47）

## 背包後台管理細化

- [x] 槍械添加子分類選擇（步槍/衝鋒槍/狙擊槍/輕機槍/霰彈槍/射手步槍）
- [x] 副武器添加子分類選擇（手槍/近戰武器）
- [x] 戰術道具保持原分類（tactical/killstreak/ultimate）
- [x] 更新資料庫 schema 支援子分類
- [x] 更新 API 支援子分類篩選
- [x] 測試子分類新增和顯示

## 物品編輯功能

- [x] 在後台管理頁面添加編輯按鈕
- [x] 建立編輯對話框（可修改名稱和分類）
- [x] 更新 API 支援物品編輯
- [x] 測試物品編輯功能

## 首頁彈窗系統

- [x] 建立彈窗資料庫模型（類型/標題/內容/關聯ID/排序/啟用狀態）
- [x] 建立彈窗 CRUD API
- [x] 實作首頁彈窗前台顯示
  - [x] 轉盤宣傳彈窗（轉盤名稱、稀有度配色背景、前往購買按鈕）
  - [x] 補給箱宣傳彈窗（補給箱名稱、稀有度配色背景、前往購買按鈕）
  - [x] 活動宣傳彈窗（活動名稱、立即前往按鈕）
  - [x] 公告彈窗（標題、內文、確定按鈕）
  - [x] 所有彈窗左上角關閉按鈕
  - [x] 彈窗按順序依次彈出
  - [x] 只在首次進入首頁時彈出（從其他頁面返回不彈出）
- [x] 建立彈窗後台管理系統
  - [x] 新增彈窗（選擇類型、設定內容、選擇關聯項目、設定排序）
  - [x] 編輯彈窗
  - [x] 刪除彈窗
  - [x] 啟用/停用彈窗
  - [x] 調整彈窗順序
- [x] 測試彈窗系統功能

## 移除每日簽到功能

- [x] 移除每日簽到彈窗組件
- [x] 移除每日簽到 API
- [x] 移除資料庫中的簽到相關欄位
- [x] 清理相關代碼
- [x] 測試移除後的功能

## Bug 修復 - 槍械子分類問題

- [x] 修改資料庫 schema，將槍械子分類改為單一欄位（subCategory: 步槍/衝鋒槍/狙擊槍/輕機槍/霰彈槍/射手步槍）
- [x] 修改副武器子分類為單一欄位（subCategory: 手槍/近戰武器）
- [x] 更新後台管理頁面，確保只能選擇一個子分類
- [x] 更新前台背包頁面，按子分類正確分組顯示
- [x] 測試槍械子分類功能

## Bug 修復 - 活動管理同步問題

- [x] 診斷活動管理前後台無法同步的原因（前台使用靜態數據）
- [x] 檢查活動 API 是否正確實現
- [x] 檢查活動資料庫表是否正確
- [x] 修復活動後台管理頁面連接到 API（改為 publicProcedure）
- [x] 修復活動前台頁面從 API 讀取數據
- [x] 測試活動新增、編輯、刪除功能

## Bug 修復 - 活動無法新增

- [x] 診斷活動無法新增的原因（returning() 問題）
- [x] 檢查資料庫函數是否正確返回
- [x] 修復活動新增 API（改為返回 { success: true }）
- [x] 測試活動新增功能

## 功能新增 - 武器庫按鈕跳轉

- [x] 設定首頁武器庫按鈕跳轉到 /skins 頁面
- [x] 測試武器庫按鈕跳轉功能

## Bug 修復 - 武器庫導航和活動新增

- [x] 修復武器庫按鈕無法導航的問題（改用 window.location.href 替代 wouter navigate）
- [x] 修復 GameMainScreen 中的 wouter 導航邏輯
- [x] 移除不必要的 useLocation import
- [x] 測試武器庫按鈕導航功能（成功導航到 /skins）
- [x] 檢查活動新增功能（表單可正常提交，但後端返回 500 錯誤）

## 建立武器庫（Skins）頁面

- [x] 建立 SkinsPage.tsx 頁面組件
- [x] 設計武器皮膚展示卡片
- [x] 添加皮膚分類導航（步槍/衝鋒槍/狙擊槍等）
- [x] 添加路由到 App.tsx
- [x] 測試武器庫頁面顯示


## Bug 修復 - 活動新增缺少 category 字段

- [x] 修復 createActivity 函數缺少 category 字段
- [x] 更新活動 API 接收 category 參數
- [x] 測試活動新增功能

## 按鈕音效系統

- [x] 生成科技感按鈕音效（多種變化）
- [x] 創建音效管理系統
- [x] 為所有按鈕添加音效
- [x] 測試音效功能


## 功能更新 - 武器庫導航到公開網域

- [x] 更新武器庫按鈕導航到 https://stickman-eload-mvjympwe.manus.space/skins
- [x] 測試導航功能


## 功能增強 - 按鈕音效和過場動畫

- [x] 為所有按鈕添加點擊音效
- [x] 實現頁面跳轉過場動畫
- [x] 測試音效和動畫效果


## 功能新增 - 大廳背景音樂系統

- [ ] 複制音樂檔案到公開目錄
- [ ] 創建背景音樂管理系統
- [ ] 實現大廳背景音樂播放（循環）
- [ ] 實現後台音樂上傳功能
- [ ] 測試背景音樂功能


## 功能新增 - 大廳背景圖片和音樂系統完成

- [x] 完成音樂系統的後端函數（getBackgroundMusic、createBackgroundMusic 等）
- [ ] 添加大廳背景圖片功能
- [ ] 實現後台背景圖片上傳功能
- [x] 修改主頁移除中間元素
- [ ] 為大廳添加背景圖片顯示
- [ ] 測試音樂和背景圖功能


## 功能新增 - 背景音樂和背景圖片系統

- [x] 修復音樂路由的類型轉換
- [x] 創建後台音樂管理頁面
- [x] 添加音樂路由到 App.tsx
- [x] 創建背景圖片表到資料庫
- [x] 執行資料庫遷移
- [x] 添加背景圖片後端函數
- [x] 添加背景圖片路由
- [x] 創建後台背景圖片管理頁面
- [x] 添加背景圖片路由到 App.tsx
- [x] 為大廳添加背景圖片顯示功能


## Bug 修復 - 音樂設定無法保存

- [x] 檢查音樂管理頁面的保存邏輯
- [x] 修復 AdminMusicPage 缺少 useState import
- [x] 添加文件上傳端點 (/api/upload)
- [x] 安裝 multer 依賴
- [x] 實現前端文件上傳功能
- [ ] 測試音樂保存功能
- [ ] 驗證大廳播放正確的音樂


## 功能新增 - 遊戲模式按鈕跳轉

- [x] 設定多人模式按鈕跳轉到 https://ff-two-sand.vercel.app/
- [x] 設定戰場模式按鈕跳轉到 https://ff-two-sand.vercel.app/
- [x] 設定打怪模式按鈕跳轉到 https://ff-two-sand.vercel.app/
- [x] 設定劇情模式按鈕跳轉到 https://ff-two-sand.vercel.app/
- [x] 測試所有遊戲模式按鈕的跳轉功能


## 功能新增 - 活動系統 HTML 內容支持

- [x] 更新資料庫 schema 添加 HTML 內容欄位到 activities 表
- [x] 執行資料庫遷移
- [x] 修改後台活動管理頁面添加 HTML 編輯器
- [x] 修改前台活動頁面實現左側活動列表
- [x] 修改前台活動頁面右側動態渲染 HTML 內容
- [x] 更新後端 API 支持 htmlContent 欄位
- [x] 測試後台 HTML 編輯和保存功能
- [x] 測試前台活動列表選擇和 HTML 渲染功能
